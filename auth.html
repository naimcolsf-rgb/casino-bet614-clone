<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Casino Royale - Ruleta Digital</title>
    <!-- Cargar Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Cargar Font Awesome para iconos -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        /* Estilos personalizados para un tema de casino lujoso y oscuro */
        body {
            font-family: 'Inter', sans-serif;
            background-color: #1a202c;
            background-image: radial-gradient(circle at center, #2d3748 0%, #1a202c 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background-color 0.5s;
        }
        /* Clase para simular estado de carga/inactivo */
        .disabled-btn {
            opacity: 0.6;
            cursor: not-allowed;
            filter: grayscale(100%);
        }
        
        /* Estilos espec铆ficos de la Ruleta */
        .wheel-container {
            width: 250px;
            height: 250px;
            position: relative;
            margin: 0 auto;
        }
        .wheel {
            width: 100%;
            height: 100%;
            border-radius: 50%;
            border: 10px solid gold;
            transition: transform 6s cubic-bezier(0.25, 0.1, 0.25, 1);
            position: relative;
            background: conic-gradient(
                /* 37 segmentos (0-36) */
                #ef4444 0% 9.72deg,  /* Rojo (1/37) */
                #10b981 9.72deg 19.44deg,  /* Verde (0) */
                #2563eb 19.44deg 29.16deg,  /* Azul (Simula Negro) */
                #f97316 29.16deg 38.88deg,  /* Naranja (Simula Rojo) */
                #ef4444 38.88deg 48.6deg,
                #2563eb 48.6deg 58.32deg,
                #f97316 58.32deg 68.04deg,
                #ef4444 68.04deg 77.76deg,
                #2563eb 77.76deg 87.48deg,
                #f97316 87.48deg 97.2deg,
                #ef4444 97.2deg 106.92deg,
                #2563eb 106.92deg 116.64deg,
                #f97316 116.64deg 126.36deg,
                #ef4444 126.36deg 136.08deg,
                #2563eb 136.08deg 145.8deg,
                #f97316 145.8deg 155.52deg,
                #ef4444 155.52deg 165.24deg,
                #2563eb 165.24deg 174.96deg,
                #f97316 174.96deg 184.68deg,
                #ef4444 184.68deg 194.4deg,
                #2563eb 194.4deg 204.12deg,
                #f97316 204.12deg 213.84deg,
                #ef4444 213.84deg 223.56deg,
                #2563eb 223.56deg 233.28deg,
                #f97316 233.28deg 243deg,
                #ef4444 243deg 252.72deg,
                #2563eb 252.72deg 262.44deg,
                #f97316 262.44deg 272.16deg,
                #ef4444 272.16deg 281.88deg,
                #2563eb 281.88deg 291.6deg,
                #f97316 291.6deg 301.32deg,
                #ef4444 301.32deg 311.04deg,
                #2563eb 311.04deg 320.76deg,
                #f97316 320.76deg 330.48deg,
                #ef4444 330.48deg 340.2deg,
                #2563eb 340.2deg 349.92deg,
                #f97316 349.92deg 360deg
            );
        }
        .marker {
            position: absolute;
            top: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 0;
            height: 0;
            border-left: 10px solid transparent;
            border-right: 10px solid transparent;
            border-top: 15px solid #ff0000;
            filter: drop-shadow(0 0 5px #ff0000);
            z-index: 10;
        }

    </style>
</head>
<body>

    <!-- Contenedor principal de la aplicaci贸n -->
    <div class="w-full max-w-sm sm:max-w-md p-6 sm:p-8 bg-gray-800 rounded-2xl shadow-2xl transition-all duration-300">
        
        <!-- Mensaje de estado (茅xito/error) -->
        <div id="message-box" class="fixed top-0 left-0 right-0 p-4 text-center hidden z-50"></div>

        <!-- Vista de Autenticaci贸n (Inicialmente visible) -->
        <div id="auth-view" class="block">
            <div class="text-center mb-6">
                <span class="text-5xl text-yellow-500 mb-2">
                    <i class="fas fa-crown"></i>
                </span>
                <h1 class="text-3xl sm:text-4xl font-extrabold text-white tracking-wider">AUTENTICACIN</h1>
            </div>

            <!-- Tabs de Login/Registro -->
            <div class="flex border-b border-gray-700 mb-6 text-xl">
                <button id="show-login" class="flex-1 py-2 text-white border-b-2 border-yellow-500 font-semibold transition duration-200">Iniciar Sesi贸n</button>
                <button id="show-register" class="flex-1 py-2 text-gray-400 border-b-2 border-transparent hover:border-gray-600 font-semibold transition duration-200">Registrarse</button>
            </div>

            <!-- Formulario de LOGIN -->
            <form id="login-form" class="space-y-4">
                <p class="text-center text-gray-400 -mt-4">Inicia Sesi贸n para Jugar</p>
                <div>
                    <input type="email" id="login-email" placeholder="Correo Electr贸nico" required
                           class="w-full px-4 py-3 bg-gray-700 text-white rounded-xl focus:ring-yellow-500 focus:border-yellow-500 border-gray-600 transition">
                </div>
                <div>
                    <input type="password" id="login-password" placeholder="Contrase帽a" required minlength="6"
                           class="w-full px-4 py-3 bg-gray-700 text-white rounded-xl focus:ring-yellow-500 focus:border-yellow-500 border-gray-600 transition">
                </div>
                <button type="submit" id="login-btn" 
                        class="w-full flex items-center justify-center py-3 bg-green-600 hover:bg-green-700 text-white font-bold rounded-xl shadow-lg shadow-green-900/50 transition duration-150 disabled-btn" disabled>
                    <i class="fas fa-arrow-right mr-2 mt-1"></i> Iniciar Sesi贸n
                </button>
                <p class="text-center text-sm mt-3">
                    驴No tienes una cuenta? <span id="toggle-register-link" class="text-yellow-500 hover:text-yellow-400 cursor-pointer">Reg铆strate</span>
                </p>
            </form>

            <!-- Formulario de REGISTRO (Inicialmente oculto) -->
            <form id="register-form" class="space-y-4 hidden">
                <p class="text-center text-gray-400 -mt-4">Crea Tu Cuenta</p>
                <div>
                    <input type="text" id="register-username" placeholder="Nombre de Usuario" required
                           class="w-full px-4 py-3 bg-gray-700 text-white rounded-xl focus:ring-red-500 focus:border-red-500 border-gray-600 transition">
                </div>
                <div>
                    <input type="email" id="register-email" placeholder="Correo Electr贸nico" required
                           class="w-full px-4 py-3 bg-gray-700 text-white rounded-xl focus:ring-red-500 focus:border-red-500 border-gray-600 transition">
                </div>
                <div>
                    <input type="password" id="register-password" placeholder="Contrase帽a" required minlength="6"
                           class="w-full px-4 py-3 bg-gray-700 text-white rounded-xl focus:ring-red-500 focus:border-red-500 border-gray-600 transition">
                </div>
                <div>
                    <input type="text" id="register-dni" placeholder="DNI" required
                           class="w-full px-4 py-3 bg-gray-700 text-white rounded-xl focus:ring-red-500 focus:border-red-500 border-gray-600 transition">
                </div>
                <button type="submit" id="register-btn"
                        class="w-full flex items-center justify-center py-3 bg-red-600 hover:bg-red-700 text-white font-bold rounded-xl shadow-lg shadow-red-900/50 transition duration-150 disabled-btn" disabled>
                    <i class="fas fa-user-plus mr-2 mt-1"></i> Registrarse
                </button>
                <p class="text-center text-sm mt-3">
                    驴Ya tienes una cuenta? <span id="toggle-login-link" class="text-yellow-500 hover:text-yellow-400 cursor-pointer">Inicia Sesi贸n</span>
                </p>
            </form>
            
        </div>
        
        <!-- Vista del Dashboard/Casino (Inicialmente oculto) -->
        <div id="dashboard-view" class="hidden">
            <div class="text-center mb-6">
                <h1 id="welcome-message" class="text-2xl sm:text-3xl font-extrabold text-white tracking-wider mb-2"></h1>
                <div class="p-4 bg-yellow-900/30 rounded-xl shadow-lg inline-block">
                    <p class="text-yellow-400 text-sm font-semibold">SALDO ACTUAL:</p>
                    <p id="current-balance" class="text-4xl font-extrabold text-yellow-500">$0.00</p>
                </div>
                <!-- Muestra el User ID -->
                <div id="user-id-container" class="mt-4 hidden text-xs text-gray-500">
                    ID Usuario: <span id="current-user-id" class="font-mono text-gray-400"></span>
                </div>
            </div>

            <!-- Controles de la Ruleta -->
            <div class="p-6 bg-gray-900 rounded-xl shadow-inner shadow-black/50 mb-6">
                <h2 class="text-xl font-bold text-white mb-4 border-b border-gray-700 pb-2"> Ruleta Digital</h2>
                
                <div class="wheel-container mb-4">
                    <div class="marker"></div>
                    <div id="roulette-wheel" class="wheel"></div>
                </div>

                <div class="flex space-x-2 mb-4">
                    <input type="number" id="bet-amount" value="10" min="1" step="1"
                           class="w-1/3 px-3 py-2 bg-gray-700 text-white rounded-xl focus:ring-yellow-500 focus:border-yellow-500 transition"
                           placeholder="Apuesta">
                    <select id="bet-type"
                            class="w-2/3 px-3 py-2 bg-gray-700 text-white rounded-xl focus:ring-yellow-500 focus:border-yellow-500 transition">
                        <option value="red">Rojo (x2)</option>
                        <option value="black">Negro (Simula Azul/Naranja) (x2)</option>
                        <option value="green">Verde (x35)</option>
                    </select>
                </div>

                <button id="spin-btn" 
                        class="w-full flex items-center justify-center py-3 bg-red-700 hover:bg-red-800 text-white font-bold rounded-xl shadow-lg shadow-red-900/50 transition duration-150">
                    <i class="fas fa-hand-point-up mr-2 mt-1"></i> 隆Girar Ruleta!
                </button>
            </div>

            <!-- Bot贸n de Salir -->
            <button id="logout-btn" 
                    class="w-full flex items-center justify-center py-2 text-sm bg-gray-600 hover:bg-gray-700 text-white font-semibold rounded-xl transition mt-4">
                <i class="fas fa-sign-out-alt mr-2 mt-1"></i> Salir
            </button>
        </div>

    </div>

    <!-- Script de Firebase (Importaci贸n) -->
    <script type="module">
        // Importaciones de Firebase
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously, signInWithCustomToken, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, updateDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        import { setLogLevel } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";
        
        setLogLevel('debug'); // Habilitar logs para depuraci贸n

        // --- Variables Globales Proporcionadas por el Entorno ---
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {};
        const initialAuthToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : undefined;

        // --- Variables Globales de la App ---
        let auth;
        let db;
        let userId = null;
        let userEmail = null; 
        let unsubscribeBalance = null; // Funci贸n para detener el listener de Firestore
        let isSpinning = false; // Estado para la ruleta

        // --- Referencias al DOM ---
        const authView = document.getElementById('auth-view');
        const dashboardView = document.getElementById('dashboard-view');
        const showLoginBtn = document.getElementById('show-login');
        const showRegisterBtn = document.getElementById('show-register');
        const loginForm = document.getElementById('login-form');
        const registerForm = document.getElementById('register-form');
        const loginBtn = document.getElementById('login-btn');
        const registerBtn = document.getElementById('register-btn');
        const currentBalanceEl = document.getElementById('current-balance');
        const welcomeMessageEl = document.getElementById('welcome-message');
        const messageBox = document.getElementById('message-box');
        const currentUserIdDisplay = document.getElementById('current-user-id');
        const userIdContainer = document.getElementById('user-id-container');
        const rouletteWheel = document.getElementById('roulette-wheel');
        const spinBtn = document.getElementById('spin-btn');
        const betAmountInput = document.getElementById('bet-amount');
        const betTypeSelect = document.getElementById('bet-type');
        const logoutBtn = document.getElementById('logout-btn');
        const toggleLoginLink = document.getElementById('toggle-login-link');
        const toggleRegisterLink = document.getElementById('toggle-register-link');
        
        // --- Constantes del Juego ---
        const RUTA_USUARIOS = `/artifacts/${appId}/public/data/users`;
        const SALDO_INICIAL = 15000;
        const resultColorMap = {
             0: 'green', 1: 'red', 2: 'black', 3: 'red', 4: 'black', 5: 'red', 6: 'black',
             7: 'red', 8: 'black', 9: 'red', 10: 'black', 11: 'red', 12: 'black',
             13: 'red', 14: 'black', 15: 'red', 16: 'black', 17: 'red', 18: 'black',
             19: 'red', 20: 'black', 21: 'red', 22: 'black', 23: 'red', 24: 'black',
             25: 'red', 26: 'black', 27: 'red', 28: 'black', 29: 'red', 30: 'black',
             31: 'red', 32: 'black', 33: 'red', 34: 'black', 35: 'red', 36: 'black',
        };
        const winMultipliers = { 'green': 35, 'red': 2, 'black': 2 };

        // --- Funciones Utilitarias ---

        function showMessage(message, type = 'info') {
            messageBox.textContent = message;
            messageBox.className = `fixed top-0 left-0 right-0 p-4 text-center z-50 transition-all duration-300`;
            if (type === 'error') messageBox.classList.add('bg-red-700', 'text-white', 'block');
            else if (type === 'success') messageBox.classList.add('bg-green-600', 'text-white', 'block');
            else messageBox.classList.add('bg-blue-600', 'text-white', 'block');
            setTimeout(() => messageBox.classList.add('hidden'), 5000);
        }

        function toggleAuthView(isRegister = false) {
            showLoginBtn.classList.toggle('border-yellow-500', !isRegister);
            showLoginBtn.classList.toggle('text-white', !isRegister);
            showLoginBtn.classList.toggle('text-gray-400', isRegister);
            showLoginBtn.classList.toggle('border-transparent', isRegister);
            
            showRegisterBtn.classList.toggle('border-red-500', isRegister);
            showRegisterBtn.classList.toggle('text-white', isRegister);
            showRegisterBtn.classList.toggle('text-gray-400', !isRegister);
            showRegisterBtn.classList.toggle('border-transparent', !isRegister);

            loginForm.classList.toggle('hidden', isRegister);
            registerForm.classList.toggle('hidden', !isRegister);
        }

        function switchView(toDashboard) {
            if (toDashboard) {
                authView.classList.replace('block', 'hidden');
                dashboardView.classList.replace('hidden', 'block');
            } else {
                dashboardView.classList.replace('block', 'hidden');
                authView.classList.replace('hidden', 'block');
                toggleAuthView(false); // Volver a Login por defecto
            }
        }

        // --- L贸gica de Firestore (REAL) ---

        function getUserDocRef(email) {
            return doc(db, RUTA_USUARIOS, email.toLowerCase());
        }

        function startBalanceListener(email) {
            if (unsubscribeBalance) unsubscribeBalance(); // Detener listener anterior
            
            const userDocRef = getUserDocRef(email);
            unsubscribeBalance = onSnapshot(userDocRef, (docSnap) => {
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    currentBalanceEl.textContent = `$${(data.balance || 0).toFixed(2)}`;
                    welcomeMessageEl.textContent = `隆Hola, ${data.username || 'Jugador'}!`;
                } else {
                    showMessage("Error: No se encontraron datos del usuario.", 'error');
                }
            }, (error) => {
                console.error("Error al escuchar saldo:", error);
                showMessage("Error de conexi贸n de saldo.", 'error');
            });
        }

        async function updateBalanceInFirestore(amount) {
            if (!userEmail || !db) return false;
            const userDocRef = getUserDocRef(userEmail);

            try {
                const docSnap = await getDoc(userDocRef);
                if (!docSnap.exists()) {
                    showMessage("Error: Usuario no encontrado para actualizar saldo.", 'error');
                    return false;
                }
                
                const currentBalance = docSnap.data().balance || 0;
                const newBalance = currentBalance + amount;

                if (newBalance < 0) {
                    showMessage("Saldo insuficiente.", 'error');
                    return false;
                }

                await updateDoc(userDocRef, { balance: newBalance });
                return true; // xito

            } catch (e) {
                console.error("Error al actualizar saldo:", e);
                showMessage(`Error al procesar apuesta: ${e.message}`, 'error');
                return false;
            }
        }

        // --- Funciones de Autenticaci贸n (Simuladas en Firestore) ---

        async function registerUser(username, email, password, dni) {
            const userDocRef = getUserDocRef(email);
            
            // 1. Verificar si el documento ya existe
            const docSnap = await getDoc(userDocRef);
            if (docSnap.exists()) {
                showMessage("El correo electr贸nico ya est谩 registrado.", 'error');
                return false;
            }

            // 2. Crear el documento
            await setDoc(userDocRef, {
                username: username,
                email: email.toLowerCase(),
                dni: dni,
                simulatedPasswordHash: password.length, // Hash simulado
                balance: SALDO_INICIAL,
                createdAt: new Date().toISOString()
            });

            showMessage(`隆Registro exitoso! Saldo inicial: $${SALDO_INICIAL}`, 'success');
            return true;
        }

        async function loginUser(email, password) {
            const userDocRef = getUserDocRef(email);
            const docSnap = await getDoc(userDocRef);

            if (!docSnap.exists()) {
                showMessage("Usuario no encontrado o contrase帽a incorrecta.", 'error');
                return false;
            }

            const userData = docSnap.data();

            // Verificaci贸n de contrase帽a simulada (comparamos la longitud)
            if (userData.simulatedPasswordHash !== password.length) {
                showMessage("Usuario no encontrado o contrase帽a incorrecta.", 'error');
                return false;
            }

            userEmail = email.toLowerCase();
            startBalanceListener(userEmail); // Iniciar escucha de saldo
            switchView(true); // Cambiar a la vista del dashboard
            showMessage(`隆Bienvenido de vuelta, ${userData.username}!`, 'success');
            return true;
        }

        async function handleLogout() {
            if (unsubscribeBalance) unsubscribeBalance(); // Detener escucha
            userEmail = null;
            // No necesitamos signOut(auth) porque usamos Auth An贸nima
            switchView(false);
            showMessage("Sesi贸n cerrada.", 'info');
        }

        // --- L贸gica de Ruleta ---

        async function spinRoulette() {
            if (isSpinning) return;
            isSpinning = true;
            spinBtn.disabled = true;
            spinBtn.classList.add('disabled-btn');

            const betAmount = parseFloat(betAmountInput.value);
            const betType = betTypeSelect.value;
            
            if (isNaN(betAmount) || betAmount <= 0) {
                showMessage("Apuesta no v谩lida.", 'error');
                isSpinning = false;
                spinBtn.disabled = false;
                spinBtn.classList.remove('disabled-btn');
                return;
            }

            // 1. Descontar la apuesta (esto actualiza Firestore)
            const deductionSuccess = await updateBalanceInFirestore(-betAmount);
            if (!deductionSuccess) {
                 // El saldo insuficiente se maneja dentro de updateBalanceInFirestore
                 isSpinning = false;
                 spinBtn.disabled = false;
                 spinBtn.classList.remove('disabled-btn');
                 return;
            }

            // 2. L贸gica de Giro
            const winningNumber = Math.floor(Math.random() * 37); // 0 a 36
            const winningColor = resultColorMap[winningNumber];
            
            const sectorAngle = 360 / 37;
            const rotationDegrees = (360 * 8) + (360 - (winningNumber * sectorAngle + sectorAngle / 2));
            
            // 3. Aplicar rotaci贸n y esperar
            rouletteWheel.style.transition = 'transform 6s cubic-bezier(0.25, 0.1, 0.25, 1)';
            rouletteWheel.style.transform = `rotate(${rotationDegrees}deg)`;

            // 4. Esperar a que termine la animaci贸n
            setTimeout(async () => {
                const winnings = calculateWinnings(betType, betAmount, winningNumber);

                if (winnings > 0) {
                    // Si gana, devuelve la apuesta original + las ganancias
                    const totalPayout = winnings; 
                    await updateBalanceInFirestore(totalPayout);
                    showMessage(`隆GANASTE! Cay贸 ${winningNumber} (${winningColor}). Ganaste: $${totalPayout.toFixed(2)}`, 'success');
                } else {
                    showMessage(`PERDISTE. Cay贸 ${winningNumber} (${winningColor}).`, 'error');
                }

                isSpinning = false;
                spinBtn.disabled = false;
                spinBtn.classList.remove('disabled-btn');
                
                rouletteWheel.style.transition = 'none';
                rouletteWheel.style.transform = `rotate(${rotationDegrees % 360}deg)`; 
            }, 6500); 
        }

        // --- FIREBASE: Inicializaci贸n ---
        
        async function initializeFirebase() {
            // 1. Verificar si la configuraci贸n de Firebase est谩 presente
            if (!Object.keys(firebaseConfig).length || firebaseConfig.apiKey === "AIzaSimulatedKey") {
                console.error("Configuraci贸n de Firebase no v谩lida o simulada.");
                showMessage("Error de configuraci贸n de Firebase. La app no puede guardar datos.", 'error');
                // Dejamos los botones deshabilitados (como est谩n en el HTML)
                return; 
            }

            try {
                // 2. Inicializar App, Auth y Firestore
                const app = initializeApp(firebaseConfig);
                auth = getAuth(app);
                db = getFirestore(app);

                // 3. Autenticar al usuario (con token o an贸nimamente)
                if (initialAuthToken) {
                    await signInWithCustomToken(auth, initialAuthToken);
                } else {
                    await signInAnonymously(auth);
                }
                
                // 4. Observador de estado de autenticaci贸n
                onAuthStateChanged(auth, (user) => {
                    if (user) {
                        userId = user.uid;
                        currentUserIdDisplay.textContent = userId;
                        userIdContainer.classList.remove('hidden');
                        
                        // 5. Habilitar botones de Auth AHORA que todo est谩 listo
                        loginBtn.disabled = false;
                        loginBtn.classList.remove('disabled-btn');
                        registerBtn.disabled = false;
                        registerBtn.classList.remove('disabled-btn');
                        
                        showMessage("Sistema listo. Puedes iniciar sesi贸n o registrarte.", 'success');
                        
                    } else {
                        userId = null;
                        currentUserIdDisplay.textContent = 'No autenticado';
                        if (dashboardView.classList.contains('block')) {
                            switchView(false);
                        }
                    }
                });

            } catch (error) {
                console.error("Error al inicializar Firebase:", error);
                showMessage(`Error de inicializaci贸n: ${error.message}`, 'error');
            }
        }
        
        // --- LISTENERS DE EVENTOS ---

        // Tabs
        showRegisterBtn.addEventListener('click', () => toggleAuthView(true));
        showLoginBtn.addEventListener('click', () => toggleAuthView(false));
        toggleLoginLink.addEventListener('click', () => toggleAuthView(false));
        toggleRegisterLink.addEventListener('click', () => toggleAuthView(true));
        
        // Dashboard
        logoutBtn.addEventListener('click', handleLogout);
        spinBtn.addEventListener('click', spinRoulette);

        // Registro
        registerForm.addEventListener('submit', async function(event) {
            event.preventDefault();
            const btn = registerBtn; 
            btn.disabled = true;
            btn.classList.add('disabled-btn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2 mt-1"></i> Registrando...';

            const username = document.getElementById('register-username').value;
            const email = document.getElementById('register-email').value;
            const password = document.getElementById('register-password').value;
            const dni = document.getElementById('register-dni').value;

            try {
                if (password.length < 6) {
                    showMessage('La contrase帽a debe tener al menos 6 caracteres.', 'error');
                    return; 
                }
                
                const success = await registerUser(username, email, password, dni);
                if (success) {
                    toggleAuthView(false); // Cambiar a Login despu茅s del registro
                }

            } catch (error) {
                console.error("Error en submit de registro:", error);
                showMessage(`Error desconocido: ${error.message}`, 'error');
            } finally {
                btn.disabled = false;
                btn.classList.remove('disabled-btn');
                btn.innerHTML = '<i class="fas fa-user-plus mr-2 mt-1"></i> Registrarse';
            }
        });

        // Login
        loginForm.addEventListener('submit', async function(event) {
            event.preventDefault();
            const btn = loginBtn; 
            btn.disabled = true;
            btn.classList.add('disabled-btn');
            btn.innerHTML = '<i class="fas fa-spinner fa-spin mr-2 mt-1"></i> Iniciando...';

            const email = document.getElementById('login-email').value;
            const password = document.getElementById('login-password').value; 
            
            await loginUser(email, password); // Pasamos la contrase帽a para la simulaci贸n
            
            btn.disabled = false;
            btn.classList.remove('disabled-btn');
            btn.innerHTML = '<i class="fas fa-arrow-right mr-2 mt-1"></i> Iniciar Sesi贸n';
        });

        // Simular Dep贸sito
        simulateDepositBtn.addEventListener('click', () => {
            updateBalanceInFirestore(100);
        });
        
        // Iniciar Firebase al cargar el script
        initializeFirebase();

    </script>
</body>
</html>